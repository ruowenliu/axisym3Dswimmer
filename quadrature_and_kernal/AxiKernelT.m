function T = AxiKernelT(y1, y2, x1, x2, n1, n2)
% (n1,n2) is the normal of (x1,x2)
% purely numerical
%
% Hai 04/23/20

n = length(y1);
T = zeros(n,4);

if (abs(x1) < 10^-14)
    % panel quadrature probably doesn't need this special case...
    keyboard
end

p = 16; N = 32*p;
tol = 1e-07;
[tt,ww] = weight_setup(p,N, tol);

for k = 1:n
    a = y1(k); b = x1; c = y2(k) - x2;
    
    if sqrt((a-b)^2+c^2) < 1e-02
        f1 = @(t) (a-b*cos(t)).*(a*cos(t)-b).*((a*cos(t)-b)*n1+c*n2)./(b^2+a^2-2*b*a*cos(t)+c^2).^(5/2);
        f2 = @(t) c*(a*cos(t)-b).*((a*cos(t)-b)*n1+c*n2)./(b^2+a^2-2*b*a*cos(t)+c^2).^(5/2);
        f3 = @(t) c*(a-b*cos(t)).*((a*cos(t)-b)*n1+c*n2)./(b^2+a^2-2*b*a*cos(t)+c^2).^(5/2);
        f4 = @(t) c^2*((a*cos(t)-b)*n1+c*n2)./(b^2+a^2-2*b*a*cos(t)+c^2).^(5/2);

        T(k,1) = sum(f1(tt).*ww);
        T(k,2) = sum(f2(tt).*ww);
        T(k,3) = sum(f3(tt).*ww);
        T(k,4) = sum(f4(tt).*ww);
    else
        P = sqrt(a^2+b^2+2*a*b+c^2); Q = 4*a*b/P^2; M = sqrt(a^2+b^2-2*a*b+c^2);
    
        [K, E] = nellipke(Q);

        T(k,1) = ((-n1*b*a^2)*4*P/(2*a*b)^3/(24*(-1+Q)^2)*( 2*(-32+Q*(64+Q*(-33+Q+Q^2))))+( n1*a^3 - b*(-n1*b*a+a*(-n1*b+n2*c)) )/P/(a*b)^2*( 1/(12*(-1+Q)^2)*(-2*(4-6*Q+Q^3))) ...
                    + (a*(-n1*b*a+a*(-n1*b+n2*c)) + b^2*(-n1*b+n2*c) )*4/(P^3*2*a*b)*(1/(6*(-1+Q)^2)*( 2*(1+(-1+Q)*Q))) -(b*a*(-n1*b+n2*c))*4/(P^5)*( 1/(3*(-1+Q)^2)*( -2*(-2+Q))))*E ...
                +((-n1*b*a^2)*4*P/(2*a*b)^3/(24*(-1+Q)^2)*(-(-2+Q)*(-1+Q)*(-32+32*Q+Q^2)) + ( n1*a^3 - b*(-n1*b*a+a*(-n1*b+n2*c)) )/P/(a*b)^2*( 1/(12*(-1+Q)^2)*((-1+Q)*(-8+8*Q+Q^2))) ...
                    + ( a*(-n1*b*a+a*(-n1*b+n2*c)) + b^2*(-n1*b+n2*c) )*4/(P^3*2*a*b)*(1/(6*(-1+Q)^2)*(-(-2+Q)*(-1+Q))) -(b*a*(-n1*b+n2*c))*4/(P^5)*( 1/(3*(-1+Q)^2)*((-1+Q))))*K ;    

        T(k,2) =  (a^2*n1*c/P/(a*b)^2*( 1/(12*(-1+Q)^2)*( -2*(4-6*Q+Q^3) ) ) + (-2*b*a*n1+a*c*n2)*c*4/(P^3*2*a*b)*(1/(6*(-1+Q)^2)*( 2*(1+(-1+Q)*Q) )) + (-b*(-b*n1+c*n2))*c*4/(P^5)*( 1/(3*(-1+Q)^2)*( -2*(-2+Q))))*E ...
                + (a^2*n1*c/P/(a*b)^2*( 1/(12*(-1+Q)^2)*((-1+Q)*(-8+8*Q+Q^2))) + (-2*b*a*n1+a*c*n2)*c*4/(P^3*2*a*b)*(1/(6*(-1+Q)^2)*(- (-2+Q)*(-1+Q) )) + (-b*(-b*n1+c*n2))*c*4/(P^5)*( 1/(3*(-1+Q)^2)*( (-1+Q))))*K;

        T(k,3) =  (-b*a*n1*c/P/(a*b)^2*( 1/(12*(-1+Q)^2)*( -2*(4-6*Q+Q^3)) )+(a^2*n1+b^2*n1-b*c*n2)*c*4/(P^3*2*a*b)*(1/(6*(-1+Q)^2)*( 2*(1+(-1+Q)*Q)))+(-b*a*n1+a*c*n2)*c*4/(P^5)*( 1/(3*(-1+Q)^2)*( -2*(-2+Q)) ))*E ...
                + (-b*a*n1*c/P/(a*b)^2*( 1/(12*(-1+Q)^2)*((-1+Q)*(-8+8*Q+Q^2)))+(a^2*n1+b^2*n1-b*c*n2)*c*4/(P^3*2*a*b)*(1/(6*(-1+Q)^2)*(-(-2+Q)*(-1+Q)))+(-b*a*n1+a*c*n2)*c*4/(P^5)*( 1/(3*(-1+Q)^2)*((-1+Q))))*K;

        T(k,4) =  (a*n1*c^2*4/(P^3*2*a*b)*(1/(6*(-1+Q)^2)*( 2*(1+(-1+Q)*Q)))+(-b*n1+c*n2)*c^2*4/(P^5)*( 1/(3*(-1+Q)^2)*( -2*(-2+Q))))*E ...
                + (a*n1*c^2*4/(P^3*2*a*b)*(1/(6*(-1+Q)^2)*( - (-2+Q)*(-1+Q) )) + (-b*n1+c*n2)*c^2*4/(P^5)*( 1/(3*(-1+Q)^2)*( (-1+Q))))*K;

    end
%     T(k,1) = ((-n1*x1*y1^2)*4*P/(2*a*b)^3/(24*(-1+Q)^2)*( 2*(-32+Q*(64+Q*(-33+Q+Q^2))))+( n1*y1^3 - x1*(-n1*x1*y1+y1*(-n1*x1+n2*(y2-x2))) )/P/(a*b)^2*( 1/(12*(-1+Q)^2)*(-2*(4-6*Q+Q^3))) ...
%                 + (y1*(-n1*x1*y1+y1*(-n1*x1+n2*(y2-x2))) + x1^2*(-n1*x1+n2*(y2-x2)) )*4/(P^3*2*a*b)*(1/(6*(-1+Q)^2)*( 2*(1+(-1+Q)*Q))) -(x1*y1*(-n1*x1+n2*(y2-x2)))*4/(P^5)*( 1/(3*(-1+Q)^2)*( -2*(-2+Q))))*E ...
%             +((-n1*x1*y1^2)*4*P/(2*a*b)^3/(24*(-1+Q)^2)*(-(-2+Q)*(-1+Q)*(-32+32*Q+Q^2)) + ( n1*y1^3 - x1*(-n1*x1*y1+y1*(-n1*x1+n2*(y2-x2))) )/P/(a*b)^2*( 1/(12*(-1+Q)^2)*((-1+Q)*(-8+8*Q+Q^2))) ...
%                 + ( y1*(-n1*x1*y1+y1*(-n1*x1+n2*(y2-x2))) + x1^2*(-n1*x1+n2*(y2-x2)) )*4/(P^3*2*a*b)*(1/(6*(-1+Q)^2)*(-(-2+Q)*(-1+Q))) -(x1*y1*(-n1*x1+n2*(y2-x2)))*4/(P^5)*( 1/(3*(-1+Q)^2)*((-1+Q))))*K ;    
%     
%     T(k,2) =  (y1^2*n1*c/P/(a*b)^2*( 1/(12*(-1+Q)^2)*( -2*(4-6*Q+Q^3) ) ) + (-2*x1*y1*n1+y1*(y2-x2)*n2)*c*4/(P^3*2*a*b)*(1/(6*(-1+Q)^2)*( 2*(1+(-1+Q)*Q) )) + (-x1*(-x1*n1+(y2-x2)*n2))*c*4/(P^5)*( 1/(3*(-1+Q)^2)*( -2*(-2+Q))))*E ...
%             + (y1^2*n1*c/P/(a*b)^2*( 1/(12*(-1+Q)^2)*((-1+Q)*(-8+8*Q+Q^2))) + (-2*x1*y1*n1+y1*(y2-x2)*n2)*c*4/(P^3*2*a*b)*(1/(6*(-1+Q)^2)*(- (-2+Q)*(-1+Q) )) + (-x1*(-x1*n1+(y2-x2)*n2))*c*4/(P^5)*( 1/(3*(-1+Q)^2)*( (-1+Q))))*K;
%     
%     T(k,3) =  (-x1*y1*n1*c/P/(a*b)^2*( 1/(12*(-1+Q)^2)*( -2*(4-6*Q+Q^3)) )+(y1^2*n1+x1^2*n1-x1*(y2-x2)*n2)*c*4/(P^3*2*a*b)*(1/(6*(-1+Q)^2)*( 2*(1+(-1+Q)*Q)))+(-x1*y1*n1+y1*(y2-x2)*n2)*c*4/(P^5)*( 1/(3*(-1+Q)^2)*( -2*(-2+Q)) ))*E ...
%             + (-x1*y1*n1*c/P/(a*b)^2*( 1/(12*(-1+Q)^2)*((-1+Q)*(-8+8*Q+Q^2)))+(y1^2*n1+x1^2*n1-x1*(y2-x2)*n2)*c*4/(P^3*2*a*b)*(1/(6*(-1+Q)^2)*(-(-2+Q)*(-1+Q)))+(-x1*y1*n1+y1*(y2-x2)*n2)*c*4/(P^5)*( 1/(3*(-1+Q)^2)*((-1+Q))))*K;
%     
%     T(k,4) =  (a*n1*c^2*4/(P^3*2*a*b)*(1/(6*(-1+Q)^2)*( 2*(1+(-1+Q)*Q)))+(-b*n1+c*n2)*c^2*4/(P^5)*( 1/(3*(-1+Q)^2)*( -2*(-2+Q))))*E ...
%             + (a*n1*c^2*4/(P^3*2*a*b)*(1/(6*(-1+Q)^2)*( - (-2+Q)*(-1+Q) )) + (-b*n1+c*n2)*c^2*4/(P^5)*( 1/(3*(-1+Q)^2)*( (-1+Q))))*K;
    
    
end
% T(:,1)=T(:,4); T(:,2)=T(:,4); T(:,3)=T(:,4); 
T = -repmat(y1,1,4).*T;


end